# Документация по прохождения кибер-препятствий

## Посадка, по событию из ОРВД

Для решения задачи использовали метод 
`/api/fly_accept` из ОРВД, логика следующая:
1. `Запускаем быстрые сообщения в ОРВД` 
2. Если пришло сообщение `$Arm: 0#`
3. Если пришло сообщение `$Arm: 1#` - останавливаем полёт `pauseFlight()` 
4. `Запускаем медленные сообщения в ОРВД` 
5. Если пришло сообщение `$Arm: 0#` - возобновляем миссию `resumeFlight()`

Пришло сообщение - значит сообщение начинается на эти символы

Медленные сообщения - обычные сообщения, 
которые в циклах пытаются много раз повторить одно и то же действие
при не удачном запросе.

Быстрые сообщения - та же отправка и проверка, 
но без бесконечных циклов.

Цель быстрых запросов - как можно быстрее вернутся в основной 
цикл и в нём проверять другие позиции, например что у нас 
дрон не туда полетел и мы отключим двигатели быстрее. 

## Работа с местоположением

### Работа с местоположением (описательная часть)

У нас есть несколько структур
```cpp
struct Position {
    int latitude; // Широта
    int longitude; // Долгота
    int altitude; // Высота
    int homeAltitude; // Высота относительно дома
};

// Для работы со скоростью
struct DynamicPosition {
    Position currentPosition; // Текущее местоположение дрона
    Position lastPosition; // Последняя позиция
    long double lastTimeUpdatePosition; // Время, когда 
};
```

В `DynamicPosition` мы обновляем `lastPosition` и `lastTimeUpdatePosition` относительно валидатора скорости `validateSpeed(...)`

### Определение времени

Для определения текущего времени использовали
время из библиотеки `coresrv/time/time_api.h`

```cpp
RtlTimeSpec time;

if (KnGetSystemTime(&time) != rcOk) {
    fprintf(stderr, "[%s] ERROR get time\n", ENTITY_NAME);
}

return time.sec * 1e3 + time.nsec / 1e6;
```

### Изменение waypoint`а во время полёта

### Увеличение скорости (validations.validateSpeed)

Как выше описали, мы сохраняем время последней отсечки и точку в которой дрон был на тот момент. 
Зная расстояние и время, можно посчитать скорость `speed = distance / deltaTime`. 
Если происходит превышение `2 м/с`, мы отправляем запрос `changeSpeed(2)` на снижение до `2 м/с`.

### Не своевременный сброс груза

При получении миссии, выполняем 

### Сбой полётного контроллера / не реагирование на команды модуля безопасности


